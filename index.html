<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2001: A VFX Project</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Michroma&family=Sono:wght@400;600;700&family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Swatch variables (HSV triplets) -->
  <link rel="stylesheet" href="assets/swatches.css">

  <style>
  :root{
    /* === Controls you’ll tweak === */
    --bg-mode: solid;        /* random | solid */
    --max-w: 800px;          /* cap the square window/canvas (e.g. 600px) */

    /* define colors */
    --gridA:rgba(255,255,255,.28);
    --gridB:rgba(255,255,255,.16);
    --colMain:rgba(255,255,255,.70);
    --colFaint:rgba(255,255,255,.45);
    --colAlt:rgba(255,100,100,0.55);
    --colBG:rgba(10,10,10,1);
    --section-gap:10px;

    /* Scope & curve controls */
    --scope: var(--colAlt);   /* #C65353 */
    --scope-thickness: 5;     /* SVG stroke-width in device px (unitless OK) */
    --bay-thickness: 2;       /* Canvas lineWidth in device px */
  }

  html,body{
    margin:0;
    min-height:100%;
    background:var(--colBG);
    color:var(--colMain);
    font-family:"Source Code Pro",monospace;
    font-size:12px;
    font-variant-numeric: tabular-nums;
    position: relative;
    overflow-x: hidden;
  }

  /* Master wrapper */
  .wrap{ min-height:100vh; display:flex; align-items:flex-start; justify-content:center; }
  .wrap.vcenter{ align-items:center; }
  .stack{ width: min(var(--max-w), 95vw); display:flex; flex-direction:column; gap: var(--section-gap); }

  /* HEADER */
  .header{ padding:14px 16px; background:var(--colBG); display:flex; flex-direction:column; align-items:flex-start; }
  .title-main {
    margin:0;
    padding:0.1em 0.3em 0.2em 0.5em;
    font-size:3rem;
    font-family:"Michroma",sans-serif;
    background: var(--colMain);
    color: var(--colBG);
    line-height:1.1;
    -webkit-text-stroke: 3px var(--colBG);
    paint-order: stroke fill;
    font-weight:bolder;
    transform:scaleX(1.1);
    letter-spacing:0.1em;
    border-radius:5px;
  }
  .title-sub {
    margin-top:.4em;
    font-family:"Sono",sans-serif;
    font-size:1.5rem;
    font-weight:500;
    text-transform:uppercase;
    letter-spacing:.15em;
    color:var(--colMain);
    transform:scaleX(1.05);
    margin-bottom:2.25rem;
    padding-left:0rem;
    margin-left: -8px;
  }

  /* WINDOW */
  .window{
    width:100%;
    max-width: var(--max-w);
    aspect-ratio: 1 / 1;
    background:var(--colBG);
    border:0px solid var(--colMain);
    border-radius:0;
    overflow:hidden;
  }
  .content{ position:relative; }
  .scope{
    position:absolute; inset:0;
    display:flex; align-items:center; justify-content:center;
    pointer-events:none;
    z-index:1;
  }
  .scope svg{ width:100%; height:100%; }
  .scope svg *{
    stroke: var(--scope) !important;
    stroke-width: var(--scope-thickness) !important;
    stroke-linecap: round !important;
    stroke-linejoin: round !important;
    fill: none;
    vector-effect: non-scaling-stroke;
  }
  .scope svg .ink{ stroke: var(--colMain) !important; }
  .scope svg{ filter: drop-shadow(0 0 2px rgba(255,26,26,0.35)); }
  .scope svg .dot{ fill: var(--colMain) !important; stroke: none !important; }
  .scope .scope-dot{
    position:absolute;
    left:50%; top:50%;
    width:20px; height:20px;
    margin-left:-10px; margin-top:-10px;
    background: var(--colMain);
    border-radius:50%;
    pointer-events:none;
    z-index:1;
  }
  canvas{
    width:100%;
    height:100%;
    display:block;
    position:relative;
    z-index:2;
  }
  .hud{
    width:100%; align-self:end; font-size:1rem; letter-spacing:0.2rem; color:var(--colMain); opacity:.95; text-align:right;
    font-family:"Source Code Pro",monospace; font-variant-numeric: tabular-nums; line-height:1.5rem; display:flex; flex-direction:column; margin-top:1.25rem;
  }
  .hud .hud-group{ display:inline-block; text-align:right; align-self:flex-end; }
  .hud .sep{ border-top:2px solid var(--colMain); height:0; width:100%; margin:4px 0 6px; }
  </style>
</head>
<body>
  <div class="wrap" id="wrap">
    <div class="stack" id="stack">
      <noscript>Enable JavaScript to load content.</noscript>
    </div>
  </div>

  <!-- source curves -->
  <script defer src="assets/curves_bay.js"></script>

  <!-- loader -->
  <script defer src="assets/js/loadStack.js"></script>

  <!-- Boot: load partial, then dynamically load app.js and init -->
  <script defer>
    window.addEventListener('DOMContentLoaded', async () => {
      const container = document.getElementById('stack');

      // 1) Load the partial
      try {
        await loadStack('assets/partials/stack.html');
      } catch (err) {
        console.error('[partial] load failed:', err);
        if (container) {
          container.innerHTML =
            '<section style="padding:1rem;border:1px dashed #f66">Partial failed to load. Check server/path.</section>';
        }
        return;
      }

      // 2) Load app.js after partial exists — build URL correctly with ?_= cache-bust
      const u = new URL('assets/js/app.js', location.href);  // relative to the current page (works on GitHub Pages)
      u.searchParams.set('_', String(Date.now()));           // adds ?_=123 or &_=123
      const s = document.createElement('script');
      s.src = u.toString();
      console.log('[boot] loading', s.src);
      s.onload = () => {
        if (typeof initApp === 'function') {
          initApp();
          window.dispatchEvent(new Event('resize'));
          if (document.fonts && document.fonts.ready) {
            document.fonts.ready.then(() => window.dispatchEvent(new Event('resize')));
          }
        } else {
          showInitError('initApp is not defined — check app.js contents.');
        }
      };
      s.onerror = () => showInitError('Could not load ' + u.pathname + ' (network/path error).');
      document.head.appendChild(s);

      function showInitError(msg){
        console.error('[init] ' + msg);
        if (container) {
          container.insertAdjacentHTML(
            'beforeend',
            '<section style="margin-top:1rem;padding:1rem;border:1px dashed #fa3">App failed to initialize. ' +
            'Check that <code>' + u.pathname + '</code> exists and loads. ' + msg + '</section>'
          );
        }
      }
    });
  </script>
</body>
</html>
